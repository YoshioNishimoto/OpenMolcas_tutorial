# 最小エネルギー円錐交差

円錐交差（conical intersection）は、同じ空間対称性で同じスピン多重度をもつ状態（ここでの状態は、主に基底状態と第一励起状態のこと）のポテンシャルエネルギー面が交差する点です。
交差するところで二つの状態のエネルギーが縮重します。
このとき、円錐交差はグローバルなポテンシャルエネルギー面上のある一点のことを指すわけではなく、シーム（seam; 縫い目）と呼ばれる曲線を構成します[^1]。
そのシームの中でエネルギーが最小（極小）となる点のことを、最小エネルギー円錐交差（MECI; minimum energy conical intersection）と呼んでいます（これはある一点を指します）。
通常（基底状態）の構造最適化での極小・最小の問題と同様に、例えばS<sub>0</sub>とS<sub>1</sub>間でのMECIを見つけたからと言って、そのMECIがあらゆるS<sub>0</sub>/S<sub>1</sub>の交差点で最小のエネルギーとなっているわけではありません。
ちなみに、スピン多重度（空間対称性も？）が異なる状態で交差するところは、項間交差（intersystem crossing）と呼ばれます。

円錐交差まわりでは、gradient difference vector (GDV; 勾配差ベクトル？)とnon-adiabatic coupling (NAC; 非断熱カップリング) vectorの
二つのベクトルに沿って分子を動かすと、縮重が解けるようになっています。
ただし、GDVとNACは必ずしも直交するとは限らないので、一般的には規格直交化してから使うこととなります。
MECIを計算するには、縮重する二つの状態のエネルギーの平均値を最小化するようにします。
しかし、前述の通りGDVとNACに沿って分子を動かすと縮重が解けてしまいますので、
それを防ぐためにGDVとNACの成分を除去（射影）しながら構造最適化をしていくこととなります。
GDVとNACによる定義される二次元の空間のことをbranching spaceまたはbranching planeと呼びます。
一方、並進・回転・GDV・NACを除いた$`3N_\mathrm{atom}-8`$次元の空間のことをintersection spaceと呼びます。
ちなみに、GDVは交差する二つの状態を$`\alpha`$と$`\beta`$として
```math
g_{\alpha \beta}^x = \frac{\mathrm{d}E_\beta}{\mathrm{d}x} - \frac{\mathrm{d}E_\alpha}{\mathrm{d}x}
```
NACは$`H_{\alpha\beta} = \langle \Psi_\alpha | \hat{H} | \Psi_\beta \rangle`$にたいして
```math
h_{\alpha \beta}^x = \frac{\mathrm{d}H_{\alpha\beta}}{\mathrm{d}x}
```
のような感じで計算しています。
そのようなわけで、MECIを見つける計算を行う際は、1ステップにつき3つの一次微分を計算する必要が出てきます。
ちなみに、NACをあらわに計算せず近似的に求める方法も存在します（updating branching plane method[^2]）。

MECIを見つけると、無輻射の（光を放出せずに）失活をする可能性を議論できます[^3]。
例えば本来蛍光が出るはずだけど、実験で蛍光が観測できない場合は、可能性の一つとして円錐交差に到達して無輻射の失活を起こしているということが考えられます。
このような失活を内部転換（internal conversion）と呼ぶ場合があります。
このとき、何らかの方法で円錐交差のエネルギーを不安定にするように分子を変えてやれば、円錐交差に到達できずに輻射失活を引き起こせる可能性が出てきます。
そのようなわけで、光化学反応においてポテンシャルエネルギー面の交差点は割と重要な役割を果たす場合があります。

一般的に用いられるTD-DFTでは、基底状態と励起状態間のMECIを計算することができません。
これは、基底状態を計算したあとで励起状態を計算すると、状態が交差する前後で扱われ方が大きく変化してしまうためです（それだけかは分かりませんが）。
結果として、円錐交差周りのポテンシャルエネルギー面が不連続になることが多いです。
というわけで、何らかの行列を対角化することで、基底状態と励起状態を同時に計算する方法を使う必要があります。
そのような方法の一つとして、CASSCFを用いることが多いです。
固有状態を同時に計算する方法なら大体上手くいくので、spin-flipのTD-DFTとかでも可能です。

## CASSCFを用いたMECIの計算

というわけで、まずはethyleneのMECIをSA2-CASSCF(2e,2o)/cc-pVDZで計算してみます。
[09_ethylene_scf.input](input_files/09_ethylene_scf.input)参照。
```
&GATEWAY
  Coord
  6
  twisted pyramidal
  C  -0.0268124148   0.0146727301  -0.6433152174
  C  -0.1789970372  -0.0454557662   0.7799261438
  H   0.6117000872   0.7368010260  -1.1825364226
  H  -0.4935302484  -0.7457813338  -1.2883279904
  H   0.9679707951  -0.0807166158   0.9463909612
  H  -0.2501109509   0.9765365107   1.2374969793
  Basis = cc-pVDZ
  Group = C1
  RICD
  Constraints
    a = Ediff 1 2
  Values
    a = 0.00
  End of Constraints

>> do while

&SEWARD

>> if (iter = 1)
&SCF
>> end if

&RASSCF
  Inactive = 7
  RAS2   = 2
  nActEl = 2 0 0
  CIRoot = 2 2 1

&SLAPAF
  Kriging

>> end do
```

大きく変わったところは、`&GATEWAY`中の`Constraints`から始まるところです。
このオプションは以前構造最適化の間に原子間距離に拘束条件を加えるときに使ったと思いますが、同じように（？）二つの状態のエネルギー差に拘束条件を加えられます。
`a = Ediff 1 2`とすると、一つ目の状態と二つ目の状態（ここではS<sub>0</sub>とS<sub>1</sub>）のエネルギー差に拘束条件を加えることとなります。
そして、`a = 0.00`で、エネルギー差をゼロにするようにしてやります。
MECIの計算には、これだけ加えればOKです。
あとは、`CIROOT`のところは、少なくとも二状態を同じweightで平均しなければいけません。[^4]
また、`&SLAPAF`に`Kriging`[^5]というキーワードを入れています。
MECIのときになぜかやたら収束が改善されるので、入れておきましょう。

これまでの構造最適化とは異なり、各構造最適化サイクルで三つの一次微分を計算します。
GDVとNACの計算を参考にすると分かると思いますが、状態$`\alpha`$のエネルギーの微分、状態$`\beta`$のエネルギーの微分、状態$`\alpha`$と$`\beta`$のカップリングの微分が必要となります。
一応、アウトプットを読むと分かると思います。

結果に関しては、まずは次の行を見ておきましょう。
```
 *************************************************************
 * Values of the primitive constraints                       *
 *************************************************************
A        : Energy difference =         0.03323917 hartree,        87.26943215 kJ/mol
           Average energy    =       -77.86413753 hartree
NADC     : H12               =         0.00000000 hartree
```
`Energy difference`のところは、現在の二つの状態のエネルギー差です。
MECIではこれがゼロになっている必要があります。
アウトプットファイルを頑張って解読すると、構造最適化が進むにつれて、ゼロに近づいていることが分かると思います。
最終的には7サイクルで収束し、このときエネルギー差は`0.00000162 hartree`とかになると思います。
必要があれば、最後の構造（または最後のサイクルで使った構造）を用いてエネルギーを計算し、
実際に二つの状態が縮重していることを確認してみましょう。

MECIの計算では、構造最適化が収束したあとで次のような結果が表示されます。
```
++ Conical Intersection Characterization
   -------------------------------------

 See: J. Chem. Theory Comput. 12 (2016) 3636-3653

     Pitch (delta_gh):                  9.51570E-02 Eh/a0
     Asymmetry (Delta_gh):              4.48586E-01
     Relative tilt (sigma=s/delta_gh):  6.88798E-01
     Tilt heading (theta_s):            3.48999E-01

     P:    3.89835E-01
     B:    1.24639E+00
     Type: peaked (P<1) single-path (B>1)

 Local linear representation:

  Local x
  mat. size =     6x    3
        0.3065596066120987      0.0939850819079442      0.5554843510595736
       -0.6039947332632954     -0.1983807829249229     -0.0505414116314465
       -0.0197061620615263      0.0426139822033203     -0.0951986603569829
        0.0354344574008531     -0.0495277846815193     -0.0069263306239608
        0.0932101337423783      0.0479987383063362     -0.3341117989071480
        0.1884966975695239      0.0633107651888195     -0.0687061495399888

  Local y
  mat. size =     6x    3
       -0.0832391301038462     -0.3158549479603950      0.0228599517065978
       -0.0624561210081598     -0.0202291303144421     -0.1513008542642928
        0.3491620628252666     -0.2638027111556285      0.1059286210496474
       -0.2852836495036473      0.1916432528694043     -0.1072666438971631
        0.1367930285839709      0.6255649470832850     -0.1147203529154595
       -0.0549761907937007     -0.2173214105221460      0.2444992783205204

     Average energy:    -77.85585554 +   0.06159265*x +   0.02241326*y
     Energy difference:   0.19031399*sqrt(r^2 +   0.44858578*t)
          r^2 = x^2 + y^2
          t = x^2 - y^2
--
```
パラメータの意味は書いてある論文を参照してください。[^6]
`Type:`と書いてあるところは円錐交差の大まかなかたちを示しています。
`P`はpeakedかslopedかを判断してくれています。
`B`のsingle-pathかbifurcatingかは、MECIの周りでPESをプロットしたときのかたちに対応しています。[^6]
また、`Local x`と`Local y`に関しては、GDVとNACの線形結合のことです。
すなわち、これら二つのベクトルに沿って分子を動かすと、縮重が解けるようになっています。
実際に、これらのベクトルに沿って分子を動かすと、次の<b>Fig. 1</b>のような二状態のポテンシャルエネルギー面が得られます。
（上と同様にpeaked single-pathのMECIです）

<img src="https://github.com/YoshioNishimoto/sandbox/blob/figure/09_PES.png" width="256">

<b>Fig. 1</b> SA2-XMS-CASPT2(12e,9o)/cc-pVDZレベルでcytosineのMECIまわりで計算したポテンシャルエネルギー面

CASPT2を用いてMECIを計算することも可能です。
[09_ethylene_pt2.input](input_files/09_ethylene_pt2.input)参照。
`CORT`というのは、内部縮約の関数を規格直交化するとき、canonical orthonormalizationを使うというオプションです。
今回はあってもなくても構いませんが。

## 演習問題

- CIからGDVとNACに沿って分子を動かすと縮重が解けるようになっている理由を、2状態の（有効）ハミルトニアンを使ったモデルで教えてください。
- [09_C4H6.xyz](input_files/09_C4H6.xyz)にて与えられるC<sub>4</sub>H<sub>6</sub>のMECIを計算してみましょう。とりあえずSA2-CASSCF(4e,4o)/cc-pVDZで良いでしょうか（もともとはXMS-CASPT2(4e,4o)/cc-pVDZで計算したMECIだったと思う）。
- 何らかのMECIを計算し、得られたGDVとNACに沿って分子を動かしエネルギーを計算し、<b>Fig. 1</b>のようにポテンシャルエネルギー面を3Dのグラフにプロットしてみましょう。このとき、当然MECIに用いる計算レベルと、エネルギーを計算する計算レベルは同じでなくてはいけません。
- CASSCFで得たMECIからGDVとNACに沿って分子を動かし、MS-CASPT2とXMS-CASPT2でエネルギーを計算し、エネルギー差をGDVとNACを変数とした二次元グラフにプロット（ヒートマップのような感じ）して、どのような感じになるか見てみましょう。こちらは、MECIに用いる計算レベルとエネルギーを計算する計算レベルは異なります。
- C<sub>6</sub>H<sub>6</sub>（benzene）の計算をしてみましょう。計算レベルは任意ですが、全ての計算を同じ計算レベルで行わなければなりません。
  - S<sub>0</sub>とS<sub>1</sub>の安定構造とエネルギーを計算しましょう。
  - S<sub>0</sub>からS<sub>1</sub>の垂直励起エネルギーを計算しましょう。ちなみに実験値は4.9 eVだとか。
  - S<sub>0</sub>からS<sub>1</sub>の断熱励起エネルギーを計算しましょう。これはS<sub>0</sub>とS<sub>1</sub>それぞれでの安定構造のエネルギー差に対応します。
  - （可能か分かりませんが）S<sub>0</sub>からS<sub>1</sub>の0–0遷移エネルギーを計算しましょう。これはS<sub>0</sub>とS<sub>1</sub>それぞれでの安定構造の零点振動エネルギーを考慮したエネルギー差に対応します。
  - 何らかの文献に示されている構造を参照してMECIを一つ計算して、S<sub>0</sub> → S<sub>1</sub>直後のエネルギー（Franck–Condon状態と呼ばれることが多い）やS<sub>1</sub> minimumとの相対エネルギーを計算してみましょう。
- やったことがないのでよく分かりませんが、何らかのintersystem crossingを計算してみましょう。

---
[^1]: 交差領域というローカルな視点では円錐交差は点に対応しますが、ポテンシャルエネルギー面をグローバルに見たときはシームに対応する。
[^2]: Maeda, S.; Ohno, K.; Morokuma, K. <i>J. Chem. Theory Comput.</i> <b>2010</b>, <i>6</i>, 1538–1545. DOI: [10.1021/ct100268](https://dx.doi.org/10.1021/ct100268)
[^3]: 無輻射の失活がMECIの一点を通るというわけではないです。失活は確率的な過程なので、本来はダイナミクスを計算する必要があります。
[^4]: 最近追加された`STAVERAGE`というオプションを使って、`STAV = 2`とかでも可能です。
[^5]: Galván, I. F.; Lindh, R. <i>J. Chem. Theory Comput.</i> <b>2023</b>, <i>19</i>, 3418–3427. DOI: [10.1021/acs.jctc.3c00389](https://dx.doi.org/10.1021/acs.jctc.3c00389)
[^6]: Galván, I. F.; Delcey, M. G.; Pedersen, T. B.; Aquilnate, F.; Lindh, R. <i>J. Chem. Theory Comput.</i> <b>2016</b>, <i>12</i>, 3636–3653. DOI: [10.1021/acs.jctc.6b00384](https://dx.doi.org/10.1021/acs.jctc.6b00384) 古くはDavid R. Yorkonyの論文参照。
