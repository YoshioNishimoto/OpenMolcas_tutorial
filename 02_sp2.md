# 一点計算（出力ファイル）

[初回](00_introduction.md)の計算ができたことにしておきます。
出力ファイルを簡単に説明しておきます。

## &GATEWAY

`&GATEWAY`で分子の対称性、基底関数、分子の構造をインプットファイルから読み出しています。

### 対称性

```
++    Symmetry information:
      ---------------------

                    Character Table for C1

                             E
                    a        1  x, y, xy, Rz, z, xz, Ry, yz, Rx, I
--
```

というのは`Character Table for C1`を見て分かるとおり、ここでは$`C_1`$対称（つまり対称性を使わない）の計算をしています。
[前回](01_sp1.md)の演習問題で出した計算が上手くいっていれば、
```
++    Symmetry information:
      ---------------------

                    --- Group Generators --- 
                    Reflection in the yz-plane  
                    Reflection in the xz-plane  
                    Reflection in the xy-plane  

                    Character Table for D2h 

                             E   s(yz) s(xz) C2(z) s(xy) C2(y) C2(x)   i   
                    ag       1     1     1     1     1     1     1     1   
                    b3u      1    -1     1    -1     1    -1     1    -1  x
                    b2u      1     1    -1    -1     1     1    -1    -1  y
                    b1g      1    -1    -1     1     1    -1    -1     1  xy, Rz
                    b1u      1     1     1     1    -1    -1    -1    -1  z
                    b2g      1    -1     1    -1    -1     1    -1     1  xz, Ry
                    b3g      1     1    -1    -1    -1    -1     1     1  yz, Rx
                    au       1    -1    -1     1    -1     1     1    -1  I
--
```
のような感じになると思います（対称性の指定の方法により、少しだけ違うかもしれません）。
自分が考えているとおりの対称性を指定できているかを確認しましょう。

### 基底関数

基底関数は分子軌道を線形結合で表現するときの基底となる、原子軌道の集まりのことです。
```
++    Basis set information:
      ----------------------


      Basis set label: H.6-31G....

      Electronic valence basis set:
      ------------------
      Associated Effective Charge   1.000000 au
      Associated Actual Charge      1.000000 au
      Nuclear Model: Point charge

      Shell  nPrim  nBasis  Cartesian Spherical Contaminant
         s       4       2        X    
--
```
`Basis set label: H.6-31G....`というところを見ると、水素原子に`6-31G`という基底関数セットを使っているということが分かるようになっています。
さらに、最後の方の行（`s       4       2        X`）を見てみると、ここでの計算はs軌道（`Shell`）を2つ（`nBasis`）使って計算をしています。
`nPrim`（原始ガウス関数？の数; number of primitive Gaussian functions）というのは、
2つのs軌道を4つのガウス関数の線形結合で表現（縮約; contraction）をしていることを意味しています。
量子化学の授業で勉強したとおり、水素様原子のシュレディンガー方程式を解くと原子軌道はスレーター関数で表すべきですが、
積分計算をしづらい（解析解が知られていない）という問題があります。
そこで、複数のガウス関数の線形結合を取ることでスレーター関数を表現するということをしています。

インプットファイルで`Basis`を変えてみましょう。
6-31G(d) (= 6-31G*)を用いると、炭素原子に次のような関数を使います。
```
      Shell  nPrim  nBasis  Cartesian Spherical Contaminant
         s      10       3        X    
         p       4       2        X    
         d       1       1        X
```
このとき、(3s2p1d)/[10s4p1d]と表現することがあります。
原始ガウス関数（？）の数はそれほど重要ではないですが。
他の基底関数を用いて計算をして、どのような関数を使っているか見てみましょう。

量子化学の授業で勉強するd軌道やf軌道は、それぞれ5個・7個から構成されるものでした。
このとき、球面調和関数（`Spherical` harmonics functions）を用いて表したと思います。
すると、d軌道の場合は$`\mathrm{d}_{xy}`$、$`\mathrm{d}_{yz}`$、$`\mathrm{d}_{zx}`$、$`\mathrm{d}_{x^2-y^2}`$、$`\mathrm{d}_{3z^2-r^2}`$というd軌道が出てきました。
ですが、これらの積分を計算するのはそれほど単純ではない（らしい）ため、プログラムによっては直交座標系（`Cartesian`）で表したd軌道、
$`\mathrm{d}_{xy}`$、$`\mathrm{d}_{yz}`$、$`\mathrm{d}_{zx}`$、$`\mathrm{d}_{x^2}`$、$`\mathrm{d}_{y^2}`$、$`\mathrm{d}_{z^2}`$を作り、
そのあとで球面調和関数に変換をするということを行っています。
上記の計算では、`Cartesian`がチェックされているため、6個からなるd軌道を使っています。

### 分子の構造

```
++    Molecular structure info:
      -------------------------
```
以降に分子の構造が示してあるわけですが、このあたりは見て分かるので省略します。
一つだけ覚えておくべき事は、Angstromは$`10^{-10}~\mathrm{m}`$という単位です。
Bohrはボーア半径、$`a_0 \approx 0.529 \times 10^{-10}~\mathrm{m}`$です。
Bohrは原子単位系とも呼ばれています。
文献等で何も単位が書いていない場合は、原子単位（atomic unit = a.u.）系を用いているかもしれません。
単位を間違えて計算をするととんでもないことが起こるので、間違えていないか確認すると良いと思います。
エネルギーも原子単位（hartree）で表されることが多いです。

## &SEWARD

`&SEWARD`は、（あまり私が気にしていないだけかもしれませんが）あまり見るところはないかなと思います。
しかし、以下の三点は確認しておいても良いと思います。

### NoCD vs RICD

最初のテスト計算では`&GATEWAY`のところに`NoCD`を書いていましたので、電子反発積分の計算方法として
```
                  Two-Electron Repulsion integrals
```
と表示されることかと思います。
一方、`NoCD`のところを`RICD`に変更して計算をすると、
```
                  RI decomposed two-electron repulsion integrals stored Cholesky style
                   - acCD auxiliary basis
                   - CD Threshold:   0.10E-03
```
のように表示され、「コレスキー分解をして二電子反発積分を保存する」という文言が表示されるようになります。
自分がどれを使っているか確認しましょう。

### 核間反発エネルギー

`Nuclear Potential Energy`というところです。
普通に計算をすると`Nuclear Potential Energy              0.52917721 au`になると思います。
原子単位でのエネルギーです。
量子化学計算と言えど、この項は古典論での計算を行っています（原子核を量子論で扱う方法も存在する）。
```math
\displaystyle{E}_\mathrm{nuc}=\sum_{A>B}\frac{Z_{A}Z_{B}}{R_{AB}}
```
*Z*<sub>*A*</sub>は原子*A*の核電荷、*R*<sub>*AB*</sub>は原子*A*と*B*の距離です。
電卓で計算してみましょう。
このエネルギーが分子構造に対して最も変化しやすい項なので、
計算している分子の構造のfinger printのようなものになっています。
ただし、異なるプログラム間では単位の扱いに差があるため、必ずしも一致しません。

### 基底関数の数

ここで対称性（既約表現）と、その対称性に属する基底関数（原子軌道）の数を示してくれます。
```
      Basis set specifications :
      Symmetry species         a
      Basis functions            4
```
ここでは水素原子が2つあり、それぞれに2つのs軌道を使いますから、合計4個の基底関数を使う計算となります。
他にも例えばethyleneをcc-pVDZで計算すると、基底関数は合計48個になります。
基底関数の数が異なるエネルギーの値を比較しても意味がない（例えばH<sub>2</sub>の計算をしても6-31G*と6-311+G**のエネルギーを比較しても意味がない）ので、
相対エネルギーを計算する際は基底関数の数が正しいかをチェックしましょう。

## &SCF

Hartree–Fockの計算をします。
Hartree–Fock方の計算および理論の詳細は、とりあえずSzabo & Ostlundのテキストを読みましょう。
と言っても、Chapter 3でHartree–Fockを扱うはずが･･･。

### Orbital specification

```
++    Orbital specifications:
      -----------------------

      Symmetry species               1
                                     a
      Frozen orbitals                0
      Occupied orbitals              1
      Secondary orbitals             3
      Deleted orbitals               0
      Total number of orbitals       4
      Number of basis functions      4   
--
```

`Frozen orbitals`はこのチュートリアルでは使わないです。
`Occupied orbitals`は二電子占有軌道です。
水素分子は2電子系ですから、一つの軌道が二電子占有されているという描像は正しいでしょう。
`Secondary orbitals`は、いわゆる仮想軌道・非占有軌道のことです。
量子化学の授業では非占有軌道が1個になると思います。
ここで3個になっているというのは、基底関数として合計4個の軌道を用いているから（一方、量子化学の授業では合計2つ）です。
4個の基底関数を用いるて対角化をすると、4個の固有ベクトル（すなわち分子軌道）が出てきます。
1個が占有軌道なので、残りの3個が非占有軌道となるといった具合です。

### Optimization specifications

Self-consistent field (SCF)を行う際の詳細を示すものですが、テクニカルなので特に説明しないです。
SCFは方程式の形をしていますが、例えば二次方程式のように解の公式みたいなもの（解析解という）があったりしません。
このため繰り返し計算により数値的に方程式を解くといったことをします。
この繰り返しを終了するためのしきい値（これ以上変化しなくなったら計算を終了するという値）が`Threshold for ...`で示されています。
基本的には、前のサイクルとのエネルギー差や密度行列の変化により判定をしています。

### Input vectors

ほとんどの量子化学計算プログラムは、以前に計算した固有ベクトル（分子軌道）を再利用することができます。
前に使った固有ベクトルを用いて計算を始めれば、求めたい解に近いところから方程式を解き始めることができるので、早く解を見つけられるという算段です。
今回は
```
      Input vectors read from INPORB
      Orbital file label: *Guess orbitals
```
と表示されており、`Guess orbitals`というのはOpenMolcasが作り出した（初期）推測軌道を使っているということを意味します。
詳しくは把握していませんが、たぶん拡張ヒュッケル法かなんかで初期軌道を作っています。

初期軌道を使うには、`&SCF`のところに例えば`FILEORB = test.ScfOrb`のように、以前の計算により得た`*.ScfOrb`や`*.RasOrb`を`FILEORB`の引数として与えてやります。
これは後の回で、CASSCFをするときに何度も使うと思います。

### Convergence information

Convergenceは収束（ある値に漸近的に近づいていくイメージ）という意味です。
SCFの方程式を解くために繰り返し計算をしていくときに、どのようにエネルギーや密度行列などが変化していくかを表にしています。
細かいところはテクニカルなのでやはり説明しませんが、
`Tot. SCF Energy`や`Energy Change`あたりは見ても良いと思います。
前者は一定の値（`-1.094807959`）に近くなっていることが分かりますし、
`Energy Change`（前のサイクルとのエネルギー差）はゼロに近くなっていることが分かり、収束している様子がよく分かるようになっています。

```
++ Convergence information
                                   SCF        iterations: Energy and convergence statistics

Iter     Tot. SCF        One-elec.       Two-elec.     Energy      Max Dij or  Max Fij      DNorm      TNorm      AccCon     Time
         Energy          Energy          Energy        Change      Delta Norm                                                in Sec.
   1    -1.094704327    -2.196322572     0.572441034   0.00E+00    1.11E-02*   7.92E-03*    1.02E+00   1.63E+00   None         0.
   2    -1.094805492    -2.193425252     0.569442549  -1.01E-04*   1.71E-03*   1.22E-03*    1.87E-02   1.62E+00   EDIIS        0.
   3    -1.094807900    -2.192966348     0.568981237  -2.41E-06*   7.36E-09    2.23E-04*    3.53E-05   1.62E+00   c2DIIS       0.
   4    -1.094807959    -2.192882342     0.568897172  -5.87E-08*   2.38E-09    3.41E-09     4.55E-08   1.62E+00   QNRc2DIIS    0.  
   5    -1.094807959    -2.192882344     0.568897174  -2.22E-16    4.35E-10    5.26E-10     2.73E-07   1.62E+00   QNRc2DIIS    0.  

       Convergence after   5 Macro Iterations
--
```


## 演習問題

- Spherical harmonicsを使う基底関数を見つけましょう。
- 核間反発のエネルギーを再現（6桁ぐらい）する計算式を考えてみましょう。どのような単位変換が必要でしょうか。
- Ethyleneをcc-pVDZや6-31G*という基底関数セットを用いて計算し、基底関数が48個になる内訳を考えてみましょう。どの原子が何個の基底関数を持ち、なぜその個数になると計算できるのでしょうか。
- 初期軌道をもちいて計算をし、SCFが収束するまでの繰り返し計算の回数が少なくなることを確認しましょう。
